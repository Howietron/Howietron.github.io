(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{417:function(s,n,e){"use strict";e.r(n);var a=e(2),t=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"rhce学习笔记"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rhce学习笔记"}},[s._v("#")]),s._v(" RHCE学习笔记")]),s._v(" "),n("p",[n("strong",[s._v("重要配置信息")])]),s._v(" "),n("p",[s._v("在考试期间，除了您就坐位置的台式机之外，还将使用多个虚拟系统。您不具有台式机系统的 root 访问权，但具有对虚拟系统的完整 root 访问权。")]),s._v(" "),n("p",[n("strong",[s._v("系统信息")])]),s._v(" "),n("p",[s._v("在本考试期间，您将操作下列虚拟系统：")]),s._v(" "),n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Howietron/Howietron/img/2023/09/1220230912141133.png",alt:"img"}}),s._v(" "),n("p",[s._v("这些系统的 IP 地址采用静态设置。请勿更改这些设置。")]),s._v(" "),n("p",[s._v("主机名称解析已配置为解析上方列出的完全限定主机名，同时也解析主机短名称。")]),s._v(" "),n("p",[n("strong",[s._v("帐户信息")])]),s._v(" "),n("p",[s._v("所有系统的 root 密码是 flectrag。")]),s._v(" "),n("p",[s._v("请勿更改 root 密码。除非另有指定，否则这将是用于访问其他系统和服务的密码。此外，除非另有指定，否则此密码也应用于您创建的所有帐户，或者任何需要设置密码的服务。")]),s._v(" "),n("p",[s._v("为方便起见，所有系统上已预装了 SSH 密钥，允许在不输入密码的前提下通过 SSH 进行 root 访问。请勿对系统上的 root SSH 配置文件进行任何修改。")]),s._v(" "),n("p",[s._v("Ansible 控制节点上已创建了用户帐户 greg。此帐户预装了 SSH 密钥，允许在 Ansible 控制节点和各个 Ansible 受管节点之间进行 SSH 登录。请勿对系统上的 greg SSH 配置文件进行任何修改。您可以从 root 帐户使用 su 访问此用户帐户。")]),s._v(" "),n("p",[n("strong",[s._v("重要信息")])]),s._v(" "),n("blockquote",[n("p",[s._v("除非另有指定，否则您的所有工作（包括 Ansible playbook、配置文件和主机清单等）应当保存在控制节点上的目录 /home/greg/ansible 中，并且应当归 greg 用户所有。所有 Ansible 相关的命令应当由 greg 用户从 Ansible 控制节点上的这个目录运行。")])]),s._v(" "),n("p",[n("strong",[s._v("其他信息")]),s._v("\n一些考试项目可能需要修改 Ansible 主机清单。您要负责确保所有以前的清单组和项目保留下来，与任何其他更改共存。您还要有确保清单中所有默认的组和主机保留您进行的任何更改。")]),s._v(" "),n("p",[s._v("考试系统上的防火墙默认为不启用，SELinux 则处于强制模式。")]),s._v(" "),n("p",[s._v("如果需要安装其他软件，您的物理系统和 Ansible 控制节点可能已设置为指向 content 上的下述存储库：")]),s._v(" "),n("blockquote",[n("p",[s._v("http://content/rhel8.0/x86_64/dvd/BaseOS")]),s._v(" "),n("p",[s._v("http://content/rhel8.0/x86_64/dvd/AppStream")])]),s._v(" "),n("p",[s._v("一些项目需要额外的文件，这些文件已在以下位置提供：")]),s._v(" "),n("blockquote",[n("p",[s._v("http://materials")])]),s._v(" "),n("p",[s._v("产品文档可从以下位置找到：")]),s._v(" "),n("p",[s._v("http://materials/docs/ansible/html")]),s._v(" "),n("p",[s._v("其他资源也进行了配置，供您在考试期间使用。关于这些资源的具体信息将在需要这些资源的项目中提供。")]),s._v(" "),n("p",[n("strong",[s._v("重要信息")])]),s._v(" "),n("p",[s._v("请注意，在评分之前，您的 Ansible 受管节点系统将重置为考试开始时的初始状态，您编写的 Ansible playbook 将通过以 greg 用户身份从控制节点上的目录 /home/greg/ansible 目录运行来应用。在 playbook 运行后，系统会对您的受管节点进行评估，以判断它们是否按照规定进行了配置。")]),s._v(" "),n("h2",{attrs:{id:"安装和配置-ansible"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装和配置-ansible"}},[s._v("#")]),s._v(" "),n("strong",[s._v("安装和配置 Ansible")])]),s._v(" "),n("blockquote",[n("p",[s._v("按照下方所述，在控制节点 172.25.250.254 上安装和配置 Ansible：")]),s._v(" "),n("p",[s._v("安装所需的软件包")]),s._v(" "),n("p",[s._v("创建名为 /home/greg/ansible/inventory 的静态清单文件，以满足以下要求：")]),s._v(" "),n("p",[s._v("172.25.250.9 是 dev 主机组的成员")]),s._v(" "),n("p",[s._v("172.25.250.10 是 test 主机组的成员")]),s._v(" "),n("p",[s._v("172.25.250.11 和 172.25.250.12 是 prod 主机组的成员")]),s._v(" "),n("p",[s._v("172.25.250.13 是 balancers 主机组的成员")]),s._v(" "),n("p",[s._v("prod 组是 webservers 主机组的成员")]),s._v(" "),n("p",[s._v("创建名为 /home/greg/ansible/ansible.cfg 的配置文件，以满足以下要求：")]),s._v(" "),n("p",[s._v("主机清单文件为 /home/greg/ansible/inventory")]),s._v(" "),n("p",[s._v("playbook 中使用的角色的位置包括 /home/greg/ansible/roles")])]),s._v(" "),n("p",[n("strong",[s._v("解题方法：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[greg@bastion ~]$ sudo yum install -y ansible\n[greg@bastion ~]$ mkdir -p /home/greg/ansible\n[greg@bastion ~]$ cd /home/greg/ansible\n[greg@bastion ansible]$ vim inventory\n[dev]\n172.25.250.9\n[test]\n172.25.250.10\n[prod]\n172.25.250.11\n172.25.250.12\n[balancers]\n172.25.250.13\n[webservers:children]\nprod\n[all:vars]\nansible_user=root\nansible_password=redhat\n[greg@bastion ansible]$ cp /etc/ansible/ansible.cfg ./\n[greg@bastion ansible]$ mkdir roles\n[greg@bastion ansible]$ vim /home/greg/ansible/ansible.cfg\n#总共只修改四行\ninventory = /home/greg/ansible/inventory\nroles_path = /home/greg/ansible/roles\nhost_key_checking = False\t\t\t\t # 68行\nremote_user = root                       # 107行\n[greg@bastion ansible]$ ansible --version\n[greg@bastion ansible]$ ansible-inventory --graph\n[greg@bastion ansible]$ ansible all -m ping # 看配置文件是否生效\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("h2",{attrs:{id:"创建和运行-ansible-临时命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建和运行-ansible-临时命令"}},[s._v("#")]),s._v(" "),n("strong",[s._v("创建和运行 Ansible 临时命令")])]),s._v(" "),n("blockquote",[n("p",[s._v("作为系统管理员，您需要在受管节点上安装软件。")]),s._v(" "),n("p",[s._v("请按照正文所述，创建一个名为 /home/greg/ansible/adhoc.sh 的 shell 脚本，该脚本将使用 Ansible 临时命令在各个受管节点上安装 yum 存储库：")]),s._v(" "),n("p",[s._v("存储库1：")]),s._v(" "),n("p",[s._v("存储库的名称为 EX294_BASE")]),s._v(" "),n("p",[s._v("描述为 EX294 base software")]),s._v(" "),n("p",[s._v("基础 URL 为 http://content/rhel8.0/x86_64/dvd/BaseOS")]),s._v(" "),n("p",[s._v("GPG 签名检查为启用状态")]),s._v(" "),n("p",[s._v("GPG 密钥 URL 为 http://content/rhel8.0/x86_64/dvd/RPM-GPG-KEY-redhat-release")]),s._v(" "),n("p",[s._v("存储库为启用状态")]),s._v(" "),n("p",[s._v("存储库2：")]),s._v(" "),n("p",[s._v("存储库的名称为 EX294_STREAM")]),s._v(" "),n("p",[s._v("描述为 EX294 stream software")]),s._v(" "),n("p",[s._v("基础 URL 为 http://content/rhel8.0/x86_64/dvd/AppStream")]),s._v(" "),n("p",[s._v("GPG 签名检查为启用状态")]),s._v(" "),n("p",[s._v("GPG 密钥 URL 为 http://content/rhel8.0/x86_64/dvd/RPM-GPG-KEY-redhat-release")]),s._v(" "),n("p",[s._v("存储库为启用状态")])]),s._v(" "),n("p",[n("strong",[s._v("解题方法：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[greg@bastion ansible]$ ansible-doc yum_repository\n[greg@bastion ansible]$ vim adhoc.sh\n#!/bin/bash\nansible all -m yum_repository -a \'name="EX294_BASE" description="EX294 base software" baseurl="http://content/rhel8.0/x86_64/dvd/BaseOS" gpgcheck=yes enabled=1 gpgkey="http://content/rhel8.0/x86_64/dvd/RPM-GPG-KEY-redhat-release"\'\nansible all -m yum_repository -a \'name="EX294_STREAM" description="EX294 stream software" baseurl="http://content/rhel8.0/x86_64/dvd/AppStream" gpgcheck=yes enabled=1 gpgkey="http://content/rhel8.0/x86_64/dvd/RPM-GPG-KEY-redhat-release"\'\n[greg@bastion ansible]$ chmod +x adhoc.sh\n[greg@bastion ansible]$ ./adhoc.sh\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("验证")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ansible dev,test,prod -m shell -a \"rpm -qa | grep -Ei 'php|ariadb'\"\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"安装软件包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装软件包"}},[s._v("#")]),s._v(" "),n("strong",[s._v("安装软件包")])]),s._v(" "),n("blockquote",[n("p",[s._v("创建一个名为 /home/greg/ansible/packages.yml 的 playbook :")]),s._v(" "),n("p",[s._v("将 php 和 mariadb 软件包安装到 dev、test 和 prod 主机组中的主机上")]),s._v(" "),n("p",[s._v("将 RPM Development Tools 软件包组安装到 dev 主机组中的主机上")]),s._v(" "),n("p",[s._v("将 dev 主机组中主机上的所有软件包更新为最新版本")])]),s._v(" "),n("p",[n("strong",[s._v("解题方法：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('\n---\n- name: 安装软件包A\n  hosts: dev,test,prod\n  tasks:\n          - name: one\n            yum:\n                    name: php\n                    state: latest\n          - name: two\n            yum:\n                    name: mariadb\n                    state: latest\n- name: 安装软件包B\n  hosts: dev\n  tasks:\n          - name: one\n            yum:\n                    name: "@RPM Development Tools"\n                    state: latest\n          - name: two\n            yum:\n                    name: "*"\n                    state: latest\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h2",{attrs:{id:"使用-rhel-系统角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-rhel-系统角色"}},[s._v("#")]),s._v(" "),n("strong",[s._v("使用 RHEL 系统角色")])]),s._v(" "),n("p",[n("strong",[s._v("😀使用 RHEL 系统角色")])]),s._v(" "),n("blockquote",[n("p",[s._v("安装 RHEL 系统角色软件包，并创建符合以下条件的 playbook /home/greg/ansible/timesync.yml ：")]),s._v(" "),n("p",[s._v("在所有受管节点上运行")]),s._v(" "),n("p",[s._v("使用 timesync 角色")]),s._v(" "),n("p",[s._v("配置该角色，以使用当前有效的 NTP 提供商")]),s._v(" "),n("p",[s._v("配置该角色，以使用时间服务器 172.25.254.254")]),s._v(" "),n("p",[s._v("配置该角色，以启用 iburst 参数")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("greg@bastion ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" rhel-system-roles\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("greg@bastion ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" ansible.cfg\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#仅修改一行")]),s._v("\nroles_path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /home/greg/ansible/roles:/usr/share/ansible/roles\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("greg@bastion ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ ansible-galaxy list\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("greg@bastion ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/share/doc/rhel-system-roles/timesync/example-timesync-playbook.yml timesync.yml\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("greg@bastion ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" timesync.yml\n---\n- hosts: all\n  vars:\n    timesync_ntp_servers:\n      - hostname: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.254\n        iburst: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n  roles:\n    - rhel-system-roles.timesync\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("验证")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ansible all -m shell -a 'cat /etc/chrony.conf'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"使用-ansible-galaxy-安装角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-ansible-galaxy-安装角色"}},[s._v("#")]),s._v(" "),n("strong",[s._v("使用 Ansible Galaxy 安装角色")])]),s._v(" "),n("blockquote",[n("p",[s._v("使用 Ansible Galaxy 和要求文件 /home/greg/ansible/roles/requirements.yml 。从以下 URL 下载角色并安装到 /home/greg/ansible/roles ：")]),s._v(" "),n("p",[s._v("http://materials/haproxy.tar 此角色的名称应当为 balancer")]),s._v(" "),n("p",[s._v("http://materials/phpinfo.tar 此角色的名称应当为 phpinfo")])]),s._v(" "),n("p",[n("strong",[s._v("解题方法：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[greg@bastion ansible]$ mkdir roles\n[greg@bastion ansible]$ vim roles/requirements.yml\n---\n- src: http://materials/haproxy.tar\n  name: balancer\n- src: http://materials/phpinfo.tar\n  name: phpinfo\n[greg@bastion ansible]$ ansible-galaxy install -r requirements.yml\n[greg@bastion ansible]$ ansible-galaxy list\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("注意 ansible-galaxy install -r需要执行两遍，否则判分可能没分")]),s._v(" "),n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Howietron/Howietron/img/2023/09/1220230912141253.png",alt:"image-20230902235326442"}}),s._v(" "),n("h2",{attrs:{id:"创建和使用角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建和使用角色"}},[s._v("#")]),s._v(" "),n("strong",[s._v("创建和使用角色")])]),s._v(" "),n("blockquote",[n("p",[s._v("根据下列要求，在 /home/greg/ansible/roles 中创建名为 apache 的角色：")]),s._v(" "),n("p",[s._v("httpd 软件包已安装，设为在系统启动时启用并启动")]),s._v(" "),n("p",[s._v("防火墙已启用并正在运行，并使用允许访问 Web 服务器的规则")]),s._v(" "),n("p",[s._v("模板文件 index.html.j2 已存在，用于创建具有以下输出的文件 /var/www/html/index.html ：")]),s._v(" "),n("p",[s._v("Welcome to HOSTNAME on IPADDRESS")]),s._v(" "),n("p",[s._v("其中，HOSTNAME 是受管节点的完全限定域名，IPADDRESS 则是受管节点的 IP 地址。")])]),s._v(" "),n("p",[s._v("**注意：**角色创建出来就可以了，无需单独进行调用测试、一旦调用使用后反而会导致下面题目报错，下面那道题马上会调用apache角色，按照网页内容及步骤操作即可~")]),s._v(" "),n("p",[s._v("解题方法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[greg@bastion roles]$ ansible-galaxy init apache\n[greg@bastion roles]$ vim apache/tasks/main.yml\n---\n- name: add httpd\n  yum:\n          name: httpd\n          state: latest\n- name: start httpd\n  service:\n          name: httpd\n          state: started\n          enabled: yes\n          \n- name: start firewalld\n  service:\n          name: firewalld\n          state: started\n          enabled: yes         \n- name: on http\n  firewalld:\n          service: http\t\t # 服务名称\n          permanent: yes\t # 重启后生效\n          state: enabled     # 开启\n          immediate: yes\t # 是否立即应用\n- name: create index\n  template:\n          src: index.html.j2\n          dest: /var/www/html/index.html\n[greg@bastion roles]$ vim apache/templates/index.html.j2\nWelcome to {{ ansible_fqdn }} on {{ ansible_default_ipv4.address }}\n\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("p",[s._v("技巧：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ansible dev -m setup -a 'filter=\"ipv4\"'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"从-ansible-galaxy-使用角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#从-ansible-galaxy-使用角色"}},[s._v("#")]),s._v(" "),n("strong",[s._v("从 Ansible Galaxy 使用角色")])]),s._v(" "),n("blockquote",[n("p",[s._v("根据下列要求，创建一个名为 /home/greg/ansible/roles.yml 的 playbook ：")]),s._v(" "),n("p",[s._v("playbook 中包含一个 play， 该 play 在 balancers 主机组中的主机上运行并将使用 balancer 角色。")]),s._v(" "),n("p",[s._v("此角色配置一项服务，以在 webservers 主机组中的主机之间平衡 Web 服务器请求的负载。")]),s._v(" "),n("p",[s._v("浏览到 balancers 主机组中的主机（例如 http://172.25.250.13 ）将生成以下输出：")]),s._v(" "),n("p",[s._v("Welcom to serverb.lab.example.com on 172.25.250.11")]),s._v(" "),n("p",[s._v("重新加载浏览器将从另一 Web 服务器生成输出：")]),s._v(" "),n("p",[s._v("Welcom to serverc.lab.example.com on 172.25.250.12")]),s._v(" "),n("p",[s._v("playbook 中包含一个 play， 该 play 在 webservers 主机组中的主机上运行并将使用 phpinfo 角色。")]),s._v(" "),n("p",[s._v("请通过 URL /hello.php 浏览到 webservers 主机组中的主机将生成以下输出：")]),s._v(" "),n("p",[s._v("Hello PHP World from FQDN")]),s._v(" "),n("p",[s._v("其中，FQDN 是主机的完全限定名称。")]),s._v(" "),n("p",[s._v("Hello PHP World from")]),s._v(" "),n("p",[s._v("serverb.lab.example.com")]),s._v(" "),n("p",[s._v("另外还有 PHP 配置的各种详细信息，如安装的 PHP 版本等。")]),s._v(" "),n("p",[s._v("同样，浏览到 http://172.25.250.12/hello.php 会生成以下输出：")]),s._v(" "),n("p",[s._v("Hello PHP World from")]),s._v(" "),n("p",[s._v("serverc.lab.example.com")]),s._v(" "),n("p",[s._v("另外还有 PHP 配置的各种详细信息，如安装的 PHP 版本等。")])]),s._v(" "),n("p",[s._v("解题方法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[greg@bastion ansible]$ vim roles.yml\n---\n- name: one\t  # 考试时，该项需要放最后，否则剧本执行报错\n  hosts: balancers\n  roles:\n          - balancer\n- name: two\n  hosts: webservers\n  roles:\n          - phpinfo\n- name: three\n  hosts: webservers   # 页面测试是做负载均衡时页面刷新负载切换比较慢（刷新页面不像模拟环境那么快）\n  roles:\n          - apache\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h2",{attrs:{id:"创建和使用逻辑卷"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建和使用逻辑卷"}},[s._v("#")]),s._v(" "),n("strong",[s._v("创建和使用逻辑卷")])]),s._v(" "),n("blockquote",[n("p",[s._v("创建一个名为 /home/greg/ansible/lv.yml 的 playbook ，它将在所有受管节点上运行以执行下列任务：")]),s._v(" "),n("p",[s._v("创建符合以下要求的逻辑卷：")]),s._v(" "),n("p",[s._v("逻辑卷创建在 research 卷组中")]),s._v(" "),n("p",[s._v("逻辑卷名称为 data")]),s._v(" "),n("p",[s._v("逻辑卷大小为 1500 MiB")]),s._v(" "),n("p",[s._v("使用 ext4 文件系统格式化逻辑卷")]),s._v(" "),n("p",[s._v("如果无法创建请求的逻辑卷大小，应显示错误信息")]),s._v(" "),n("p",[s._v("Could not create logical volume of that size")]),s._v(" "),n("p",[s._v("，并且应改为使用大小 800 MiB。")]),s._v(" "),n("p",[s._v("如果卷组 research 不存在，应显示错误信息")]),s._v(" "),n("p",[s._v("Volume group done not exist")]),s._v(" "),n("p",[s._v("。")]),s._v(" "),n("p",[s._v("不要以任何方式挂载逻辑卷")])]),s._v(" "),n("p",[n("strong",[s._v("解题方法：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[greg@bastion ansible]$ vim lv.yml\n---\n- name: 创建和使用逻辑卷\n  hosts: all\n  tasks:\n          - block:\n                - name: one\n                  lvol:\n                          vg: research\n                          lv: data\n                          size: 1500\n                - name: two\n                  filesystem:\n                          fstype: ext4\n                          dev: /dev/research/data\n            rescue:\n                  - name: err msg 1\n                    debug:\n                          msg: Could not create logical volume of that size\n                  - name: three\n                    lvol:\n                        vg: research\n                        lv: data\n                        size: 800\n                    when: ansible_lvm.vgs.research is defined \n                  - name: err msg 1\n                    debug:\n                          msg: Volume group done not exist\n                    when: ansible_lvm.vgs.research is undefined\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("h2",{attrs:{id:"生成主机文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生成主机文件"}},[s._v("#")]),s._v(" "),n("strong",[s._v("生成主机文件")])]),s._v(" "),n("blockquote",[n("p",[s._v("将一个初始模板文件从 http://materials/hosts.j2 下载到 /home/greg/ansible")]),s._v(" "),n("p",[s._v("完成该模板，以便用它生成以下文件：针对每个清单主机包含一行内容，其格式与 /etc/hosts 相同")]),s._v(" "),n("p",[s._v("创建名为 /home/greg/ansible/hosts.yml 的 playbook ，它将使用此模板在 dev 主机组中的主机上生成文件 /etc/myhosts 。")]),s._v(" "),n("p",[s._v("该 playbook 运行后， dev 主机组中主机上的文件 /etc/myhosts 应针对每个受管主机包含一行内容：")]),s._v(" "),n("p",[s._v("127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4")]),s._v(" "),n("p",[s._v("::1 localhost localhost.localdomain localhost6 localhost6.localdomain6")]),s._v(" "),n("p",[s._v("172.25.250.9 workstation.lab.example.com workstation")]),s._v(" "),n("p",[s._v("172.25.250.10 servera.lab.example.com servera")]),s._v(" "),n("p",[s._v("172.25.250.11 serverb.lab.example.com serverb")]),s._v(" "),n("p",[s._v("172.25.250.12 serverc.lab.example.com serverc")]),s._v(" "),n("p",[s._v("172.25.250.13 serverd.lab.example.com serverd")]),s._v(" "),n("p",[s._v("注：清单主机名称的显示顺序不重要。")])]),s._v(" "),n("p",[s._v("**温馨提示：**目前解题方法A、B没有绝对好坏之分，使用A更简单，但少部分同学反映会被扣分，但目前还不能确定是否为学生考试中自己犯了其他错误导致的。而B方法是红帽原厂标准答案，从理论上更加靠谱，缺点是记忆复杂。请同学们根据自己的备考进度和自身情况进行取舍。")]),s._v(" "),n("p",[s._v("解题方法A：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[greg@bastion ansible]$ wget http://materials/hosts.j2\n[greg@bastion ansible]$ vim hosts.j2\n127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1 localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n172.25.250.9    workstation.lab.example.com      workstation\n172.25.250.10   servera.lab.example.com servera\n172.25.250.11   serverb.lab.example.com serverb\n172.25.250.12   serverc.lab.example.com serverc\n172.25.250.13   serverd.lab.example.com serverd\n[greg@bastion ansible]$ vim hosts.yml\n---\n- name: 生成主机文件\n  hosts: dev\n  tasks:\n          - name: one\n            template:\n                    src: /home/greg/ansible/hosts.j2\n                    dest: /etc/myhosts\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("解题方法B：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[greg@bastion ansible]$ wget http://materials/hosts.j2\n[greg@bastion ansible]$ vim hosts.j2\n127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1 localhost localhost.localdomain localhost6 localhost6.localdomain\n{% for host in groups['all'] %}\n{{ hostvars[host]['ansible_facts']['default_ipv4']['address'] }} {{ hostvars[host]['ansible_facts']['fqdn'] }} {{ hostvars[host]['ansible_facts']['hostname'] }}\n{% endfor %}\n[greg@bastion ansible]$ vim hosts.yml\n---\n- name: 生成主机文件\n  hosts: all\n  tasks:\n          - name: one\n            template:\n                    src: /home/greg/ansible/hosts.j2\n                    dest: /etc/myhosts\n            when: 'inventory_hostname in groups.dev'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h2",{attrs:{id:"修改文件内容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改文件内容"}},[s._v("#")]),s._v(" "),n("strong",[s._v("修改文件内容")])]),s._v(" "),n("blockquote",[n("p",[s._v("按照下方所述，创建一个名为 /home/greg/ansible/issue.yml 的 playbook ：")]),s._v(" "),n("p",[s._v("该 playbook 将在所有清单主机上运行")]),s._v(" "),n("p",[s._v("该 playbook 会将 /etc/issue 的内容替换为下方所示的一行文本：")]),s._v(" "),n("p",[s._v("在 dev 主机组中的主机上，这行文本显示 为：Development")]),s._v(" "),n("p",[s._v("在 test 主机组中的主机上，这行文本显示 为：Test")]),s._v(" "),n("p",[s._v("在 prod 主机组中的主机上，这行文本显示 为：Production")])]),s._v(" "),n("p",[n("strong",[s._v("解题方法：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[greg@bastion ansible]$ vim issue.yml\n---\n- name: 修改文件内容\n  hosts: all\n  tasks:\n          - name: one\n            copy:\n                    content: 'Development'\n                    dest: /etc/issue\n            when: inventory_hostname in groups.dev\n          - name: two\n            copy:\n                    content: 'Test'\n                    dest: /etc/issue\n            when: inventory_hostname in groups.test\n          - name: three\n            copy:\n                    content: 'Production'\n                    dest: /etc/issue\n            when: inventory_hostname in groups.prod\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h2",{attrs:{id:"创建-web-内容目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建-web-内容目录"}},[s._v("#")]),s._v(" "),n("strong",[s._v("创建 Web 内容目录")])]),s._v(" "),n("blockquote",[n("p",[s._v("按照下方所述，创建一个名为 /home/greg/ansible/webcontent.yml 的 playbook ：")]),s._v(" "),n("p",[s._v("该 playbook 在 dev 主机组中的受管节点上运行")]),s._v(" "),n("p",[s._v("创建符合下列要求的目录 /webdev ：")]),s._v(" "),n("p",[s._v("所有者为 webdev 组")]),s._v(" "),n("p",[s._v("具有常规权限：owner=read+write+execute ， group=read+write+execute ，other=read+execute")]),s._v(" "),n("p",[s._v("具有特殊权限：设置组 ID")]),s._v(" "),n("p",[s._v("用符号链接将 /var/www/html/webdev 链接到 /webdev")]),s._v(" "),n("p",[s._v("创建文件 /webdev/index.html ，其中包含如下所示的单行文件： Development")]),s._v(" "),n("p",[s._v("在 dev 主机组中主机上浏览此目录（例如 http://172.25.250.9/webdev/ ）将生成以下输出：")]),s._v(" "),n("p",[s._v("Development")])]),s._v(" "),n("p",[n("strong",[s._v("解题方法：")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("greg@bastion ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" webcontent.yml\n---\n- name: create web content\n  hosts: dev\n  tasks:\n          - name: create group     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 模拟环境需要加这个")]),s._v("\n            group:\n                    name: webdev\n                    state: present\n          - name: create /webdev\n            file:\n                    path: /webdev\n                    group: webdev\n                    mode: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2775'")]),s._v("\n                    state: directory\n          - name: create "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v("\n            file:\n                    src: /webdev\n                    dest: /var/www/html/webdev\n                    state: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v("\n          - name: create index.html\n            copy:\n                    content: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Development'")]),s._v("\n                    dest: /webdev/index.html\n                    setype: httpd_sys_content_t\n          - name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" httpd\n            yum:\n                    name: httpd\n                    state: latest\n          - name: start httpd\n            service:\n                    name: httpd\n                    state: started\n                    enabled: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n          - name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" http "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" on firewall\n            firewalld:\n                    service: http\n                    state: enabled\n                    immediate: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n                    permanent: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br")])]),n("h2",{attrs:{id:"配置-cron-作业-新增"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-cron-作业-新增"}},[s._v("#")]),s._v(" "),n("strong",[s._v("配置 cron 作业（新增）")])]),s._v(" "),n("blockquote",[n("p",[s._v("创建一个名为 /home/greg/ansible/cron.yml 的 playbook ，")]),s._v(" "),n("p",[s._v("配置 "),n("code",[s._v("cron")]),s._v(" 作业，该作业"),n("code",[s._v("每隔 2 分钟")]),s._v("运行并执行以下命令：")]),s._v(" "),n("p",[n("code",[s._v('logger "EX294 in progress"')]),s._v("，以用户 "),n("code",[s._v("natasha")]),s._v(" 身份运行")])]),s._v(" "),n("p",[s._v("解题方法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[greg@bastion ansible]$ vim cron.yml\n---\n- name: 配置 cron 作业\n  hosts: all\n  tasks:\n          - name: one\n            user:\n                    name: natasha\n                    state: present\n          - name: two\n            cron:\n                    name: "logger info"\n                    minute: "*/2"\n                    user: natasha\n                    job: logger "EX294 in progress"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"生成硬件报告"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生成硬件报告"}},[s._v("#")]),s._v(" "),n("strong",[s._v("生成硬件报告")])]),s._v(" "),n("blockquote",[n("p",[s._v("创建一个名为 /home/greg/ansible/hwreport.yml 的 playbook ，它将在所有受管节点上生成含有以下信息的输出文件 /root/hwreport.txt ：")]),s._v(" "),n("p",[s._v("清单主机名称")]),s._v(" "),n("p",[s._v("以 MB 表示的总内存大小")]),s._v(" "),n("p",[s._v("BIOS 版本")]),s._v(" "),n("p",[s._v("磁盘设备 vda 的大小")]),s._v(" "),n("p",[s._v("磁盘设备 vdb 的大小")]),s._v(" "),n("p",[s._v("输出文件中的每一行含有一个 key=value 对。")]),s._v(" "),n("p",[s._v("您的 playbook 应当：")]),s._v(" "),n("p",[s._v("从 http://materials/hwreport.empty 下载文件，并将它保存为 /root/hwreport.txt")]),s._v(" "),n("p",[s._v("使用正确的值改为 /root/hwreport.txt")]),s._v(" "),n("p",[s._v("如果硬件项不存在，相关的值应设为 NONE")])]),s._v(" "),n("p",[s._v("解题方法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[greg@bastion ansible]$ vim hwreport.yml\n---\n- name: 生成硬件报告\n  hosts: all\n  vars:\n          hw_all:\n                  - hw_name: HOST\n                    hw_cont: "{{ inventory_hostname | default(\'NONE\',true) }}"\n                  - hw_name: MEMORY\n                    hw_cont: "{{ ansible_memtotal_mb | default(\'NONE\',true) }}"\n                  - hw_name: BIOS\n                    hw_cont: "{{ ansible_bios_version | default(\'NONE\',true) }}"\n                  - hw_name: DISK_SIZE_VDA\n                    hw_cont: "{{ ansible_devices.vda.size | default(\'NONE\',true) }}"\n                  - hw_name: DISK_SIZE_VDB\n                    hw_cont: "{{ ansible_devices.vdb.size | default(\'NONE\',true) }}"\n  tasks:\n          - name: one\n            get_url:\n                    url: http://materials/hwreport.empty\n                    dest: /root/hwreport.txt\n          - name: two\n            lineinfile:\n                    path: /root/hwreport.txt\n                    regexp: "^{{ item.hw_name }}"\n                    line: "{{ item.hw_name }}={{ item.hw_cont }}"\n            loop: "{{ hw_all }}"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('ansible dev -m setup -a "filter=*devices*"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"创建密码库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建密码库"}},[s._v("#")]),s._v(" "),n("strong",[s._v("创建密码库")])]),s._v(" "),n("blockquote",[n("p",[s._v("按照下方所述，创建一个 Ansible 库来存储用户密码：")]),s._v(" "),n("p",[s._v("库名称为 /home/greg/ansible/locker.yml")]),s._v(" "),n("p",[s._v("库中含有两个变量，名称如下：")]),s._v(" "),n("p",[s._v("pw_developer，值为 Imadev")]),s._v(" "),n("p",[s._v("pw_manager，值为 Imamgr")]),s._v(" "),n("p",[s._v("用于加密和解密该库的密码为 whenyouwishuponastar")]),s._v(" "),n("p",[s._v("密码存储在文件 /home/greg/ansible/secret.txt 中")])]),s._v(" "),n("p",[s._v("解题方法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[greg@bastion ansible]$ vim ansible.cfg\n#仅修改一行\nvault_password_file = /home/greg/ansible/secret.txt\n[greg@bastion ansible]$ vim locker.yml\n---\npw_developer: Imadev\npw_manager: Imamgr\n[greg@bastion ansible]$ echo whenyouwishuponastar > secret.txt\n[greg@bastion ansible]$ ansible-vault encrypt locker.yml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"创建用户帐户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建用户帐户"}},[s._v("#")]),s._v(" "),n("strong",[s._v("创建用户帐户")])]),s._v(" "),n("blockquote",[n("p",[s._v("从 http://materials/user_list.yml 下载要创建的用户的列表，并将它保存到 /home/greg/ansible")]),s._v(" "),n("p",[s._v("在本次考试中使用在其他位置创建的密码库 /home/greg/ansible/locker.yml 。创建/home/greg/ansible/users.yml 的 playbook ，从而按以下所述创建用户帐户：")]),s._v(" "),n("p",[s._v("职位描述为 developer 的用户应当：")]),s._v(" "),n("p",[s._v("在 dev 和 test 主机组中的受管节点上创建")]),s._v(" "),n("p",[s._v("从 pw_developer 变量分配密码")]),s._v(" "),n("p",[s._v("配置用户uid")]),s._v(" "),n("p",[s._v("是补充组 devops 的成员")]),s._v(" "),n("p",[s._v("职位描述为 manager 的用户应当：")]),s._v(" "),n("p",[s._v("在 prod 主机组中的受管节点上创建")]),s._v(" "),n("p",[s._v("从 pw_manager 变量分配密码")]),s._v(" "),n("p",[s._v("配置用户uid")]),s._v(" "),n("p",[s._v("是补充组 opsmgr 的成员")]),s._v(" "),n("p",[s._v("密码采用 SHA512 哈希格式。")]),s._v(" "),n("p",[s._v("您的 playbook 应能够在本次考试中使用在其他位置创建的库密码文件 /home/greg/ansible/secret.txt 正常运行。")])]),s._v(" "),n("p",[s._v("解题方法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[greg@bastion ansible]$ wget http://materials/user_list.yml\n[greg@bastion ansible]$ vim users.yml\n---\n- name: create user\n  hosts: all\n  vars_files:\n          - /home/greg/ansible/user_list.yml\n          - /home/greg/ansible/locker.yml\n  tasks:\n          - name: create devops\n            group:\n                    name: devops\n                    state: present\n            when: item.job == \'developer\' and (inventory_hostname in groups.dev or inventory_hostname in groups.test)\n            loop: "{{ users }}"\n\n          - name: create users\n            user:\n                    name: "{{ item.name }}"\n                    uid: "{{ item.uid }}"\n                    groups: devops\n                    password: "{{ pw_developer | password_hash(\'sha512\',\'mysecretsalt\') }}"\n            when: item.job == \'developer\' and (inventory_hostname in groups.dev or inventory_hostname in groups.test)\n            loop: "{{ users }}"\n          - name: create opsmgr\n            group:\n                    name: opsmgr\n                    state: present\n            when: item.job == \'manager\' and inventory_hostname in groups.prod\n            loop: "{{ users }}"\n\n          - name: create users\n            user:\n                    name: "{{ item.name }}"\n                    uid: "{{ item.uid }}"\n                    groups: opsmgr\n                    password: "{{ pw_manager | password_hash(\'sha512\',\'mysecretsalt\') }}"\n            when: item.job == \'manager\' and inventory_hostname in groups.prod\n            loop: "{{ users}}"\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br")])]),n("h2",{attrs:{id:"更新-ansible-库的密钥"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新-ansible-库的密钥"}},[s._v("#")]),s._v(" "),n("strong",[s._v("更新 Ansible 库的密钥")])]),s._v(" "),n("blockquote",[n("p",[s._v("按照下方所述，更新现有 Ansible 库的密钥：")]),s._v(" "),n("p",[s._v("从 http://materials/salaries.yml 下载 Ansible 库到 /home/greg/ansible")]),s._v(" "),n("p",[s._v("当前的库密码为 insecure8sure")]),s._v(" "),n("p",[s._v("新的库密码为 bbs2you9527")]),s._v(" "),n("p",[s._v("库使用新密码保持加密状态")])]),s._v(" "),n("p",[s._v("解题方法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[greg@bastion ansible]$ wget http://materials/salaries.yml\n[greg@bastion ansible]$ ansible-vault rekey --ask-vault-pass salaries.yml\nVault password: 粘贴当前密码\nNew Vault password: 粘贴新密码\nConfirm New Vault password: 粘贴新密码\n[greg@bastion ansible]$ ansible-vault view salaries.yml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"创建分区-隐藏题、有概率出现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建分区-隐藏题、有概率出现"}},[s._v("#")]),s._v(" "),n("strong",[s._v("创建分区（隐藏题、有概率出现）")])]),s._v(" "),n("blockquote",[n("p",[s._v("在balancers主机上，划分新的分区，设备为/dev/vdd，编号1，大小1500m，格式化成ext4，mount到/newpart1目录，如果空间不够，分800m，如果没有vdd，报错")])]),s._v(" "),n("p",[s._v("解题方法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("---\n- name: 创建分区\n  hosts: balancers\n  tasks:\n          - block:\n                  - name: one\n                    file:\n                            path: /newpart1\n                            state: directory\n                  - name: two\n                    parted:\n                            device: /dev/vdd\n                            number: 1\n                            state: present\n                            part_end: 1500MiB\n                  - name: three\n                    filesystem:\n                            fstype: ext4\n                            dev: /dev/vdd1\n                  - name: four\n                    mount:\n                            path: /newpart1\n                            src: /dev/vdd1\n                            fstype: ext4\n                            state: mounted\n            rescue:\n                    - debug:\n                            msg: Could not create partation of that size\n                    - name: five\n                      parted:\n                              device: /dev/vdd\n                              number: 1\n                              state: present\n                              part_end: 800MiB\n                      when: ansible_facts.devices.vdd is defined\n                    - name: six\n                      filesystem:\n                              fstype: ext4\n                              dev: /dev/vdd1\n                      when: ansible_facts.devices.vdd is defined\n                    - name: seven\n                      mount:\n                              path: /newpart1\n                              src: /dev/vdd1\n                              fstype: ext4\n                              state: mounted\n                      when: ansible_facts.devices.vdd is defined\n                    - debug:\n                            msg: Disk does not exist\n                      when: ansible_facts.devices.vdd is undefined\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br")])]),n("h2",{attrs:{id:"安装rhel角色-隐藏题、有概率出现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装rhel角色-隐藏题、有概率出现"}},[s._v("#")]),s._v(" "),n("strong",[s._v("安装RHEL角色（隐藏题、有概率出现）")])]),s._v(" "),n("blockquote",[n("p",[s._v("安装RHEL角色，并使用SELinux角色，要求在所有节点运行，将SELinux设置为强制模式。")])]),s._v(" "),n("p",[n("strong",[s._v("解题方法：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 如果第4题不做的话下面步骤可能会报错，所有不做第4题需要执行以下操作\n[greg@bastion ansible]$ sudo yum install rhel-system-roles\n[greg@bastion ansible]$ vim ansible.cfg\n#仅修改一行\nroles_path = /home/greg/ansible/roles:/usr/share/ansible/roles\n[greg@bastion ansible]$ ansible-galaxy list\n# 如果第4题做的话可以不用执行上面操作\n[greg@bastion ansible]$ cp -rf /usr/share/doc/rhel-system-roles/selinux/example-selinux-playbook.yml ./\n[greg@bastion ansible]$ vim selinux.yml\n#安装出来后可以改也可以不改，改的话就剩下这些就可以，多余的删除。\n---\n- hosts: all\n  vars:\n          selinux_policy: targeted\n          selinux_state: enforcing\n  roles:\n    - role: roles/rhel-system-roles.selinux\n  tasks:\n          - name: apply SElinux role\n            block:\n                    - include_roles:\n                            name: roles/rhel-system-roles.selinux\n            rescue:\n                    - name: check\n                      fail:\n                      when: not selinux_reboot_required\n                    - name: reboot\n                      reboot:\n                    - name: changed\n                      include_role:\n                        name: roles/rhel-system-roles.selinux\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);